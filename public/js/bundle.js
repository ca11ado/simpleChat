(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

/**
 * Created by tos on 06.11.2015.
 */

var chat = require('./chat/chat');
var ws = require('./chat/websocket');

console.log('start app');

ws.connect('ws://localhost:8080');

ws.onMsg('myMsg', function (data) {
  console.log('New myMsg message', data);
});

setTimeout(function () {
  ws.sendTestMsg('test message from app');
}, 2000);

},{"./chat/chat":2,"./chat/websocket":3}],2:[function(require,module,exports){
'use strict';

/**
 * Created by tos on 06.11.2015.
 */

var ws = require('./websocket.js');

setTimeout(function () {
  ws.sendTestMsg('test message from chat');
}, 2000);

module.exports = [{
  name: 't0s',
  messages: 10
}, {
  name: 'test',
  messages: 5
}];

},{"./websocket.js":3}],3:[function(require,module,exports){
'use strict';

/**
 * Created by tos on 07.11.2015.
 */

var _socket = undefined,
    _events = {};
var WS_TYPE_NEW = 'new',
    WS_TYPE_MSG = "message";

function message(type, data) {
  switch (type) {
    case types.NEW:
      return { type: types.NEW, login: data.login };
      break;
    case types.MESSAGE:
      return { type: types.MESSAGE, login: data.login, msg: data.msg, time: data.time };
      break;
    default:
    //nothing
  }
}

var WS = {

  connect: function connect(url) {
    console.log('starting ws');
    if (_socket) return Error('Уже есть соединение');

    _socket = new WebSocket(url);

    _socket.onopen = function () {
      _socket.send('Hello world2');
    };
    _socket.onclose = function (event) {
      console.log('Код: ' + event.code + ' причина: ' + event.reason);
    };
    _socket.onmessage = function (event) {
      WS.emitMsg('myMsg', event.data);
      console.log("Получены данные" + event.data);
    };
    _socket.onerror = function (error) {
      console.log("Ошибка " + error.message);
    };

    return _socket;
  },

  getSocket: function getSocket() {
    return _socket;
  },

  onMsg: function onMsg(event, callback) {
    _events[event] = _events[event] ? _events[event].push(callback) : [];
  },

  emitMsg: function emitMsg(event, arg) {
    if (_events.hasOwnProperty(event)) {
      _events[event].map(function (v) {
        v(arg);
      });
    }
  },

  sendTestMsg: function sendTestMsg(txt) {
    _socket.send(txt);
  }

};

module.exports = WS;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiYXBwLmpzIiwiY2hhdC5qcyIsIndlYnNvY2tldC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQ0lBLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNsQyxJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7QUFFckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQzs7QUFFekIsRUFBRSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDOztBQUVsQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxVQUFVLElBQUksRUFBRTtBQUNoQyxTQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ3hDLENBQUMsQ0FBQzs7QUFFSCxVQUFVLENBQUMsWUFBVTtBQUNuQixJQUFFLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Q0FDekMsRUFBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7Ozs7O0FDYlIsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7O0FBRW5DLFVBQVUsQ0FBQyxZQUFVO0FBQ25CLElBQUUsQ0FBQyxXQUFXLENBQUMsd0JBQXdCLENBQUMsQ0FBQztDQUMxQyxFQUFDLElBQUksQ0FBQyxDQUFDOztBQUVSLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FDZjtBQUNFLE1BQUksRUFBRSxLQUFLO0FBQ1gsVUFBUSxFQUFFLEVBQUU7Q0FDYixFQUNEO0FBQ0UsTUFBSSxFQUFFLE1BQU07QUFDWixVQUFRLEVBQUUsQ0FBQztDQUNaLENBQ0YsQ0FBQzs7Ozs7Ozs7O0FDZkYsSUFBSSxPQUFPLFlBQUE7SUFDUCxPQUFPLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLElBQU0sV0FBVyxHQUFHLEtBQUs7SUFDbkIsV0FBVyxHQUFHLFNBQVMsQ0FBQzs7QUFFOUIsU0FBUyxPQUFPLENBQUMsSUFBSSxFQUFDLElBQUksRUFBRTtBQUMxQixVQUFRLElBQUk7QUFDVixTQUFLLEtBQUssQ0FBQyxHQUFHO0FBQ1osYUFBTyxFQUFDLElBQUksRUFBRSxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFDLENBQUM7QUFDNUMsWUFBTTtBQUFBLEFBQ1IsU0FBSyxLQUFLLENBQUMsT0FBTztBQUNoQixhQUFPLEVBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQztBQUMvRSxZQUFNO0FBQUEsQUFDUjs7QUFBUyxHQUVWO0NBQ0Y7O0FBRUQsSUFBSSxFQUFFLEdBQUc7O0FBRVAsU0FBTyxFQUFFLGlCQUFTLEdBQUcsRUFBRTtBQUNyQixXQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzNCLFFBQUksT0FBTyxFQUFFLE9BQU8sS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7O0FBRWpELFdBQU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7QUFFN0IsV0FBTyxDQUFDLE1BQU0sR0FBRyxZQUFXO0FBQzFCLGFBQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7S0FDOUIsQ0FBQztBQUNGLFdBQU8sQ0FBQyxPQUFPLEdBQUcsVUFBUyxLQUFLLEVBQUU7QUFBRSxhQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxHQUFHLFlBQVksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7S0FBRSxDQUFDO0FBQ3ZHLFdBQU8sQ0FBQyxTQUFTLEdBQUcsVUFBUyxLQUFLLEVBQUU7QUFDbEMsUUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2hDLGFBQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzdDLENBQUM7QUFDRixXQUFPLENBQUMsT0FBTyxHQUFHLFVBQVMsS0FBSyxFQUFFO0FBQUUsYUFBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQUUsQ0FBQzs7QUFFOUUsV0FBTyxPQUFPLENBQUM7R0FDaEI7O0FBRUQsV0FBUyxFQUFFLHFCQUFXO0FBQ3BCLFdBQU8sT0FBTyxDQUFDO0dBQ2hCOztBQUVELE9BQUssRUFBRSxlQUFTLEtBQUssRUFBRSxRQUFRLEVBQUU7QUFDL0IsV0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztHQUN0RTs7QUFFRCxTQUFPLEVBQUUsaUJBQVMsS0FBSyxFQUFFLEdBQUcsRUFBRTtBQUM1QixRQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDakMsYUFBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFTLENBQUMsRUFBQztBQUM1QixTQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7T0FDUixDQUFDLENBQUM7S0FDSjtHQUNGOztBQUVELGFBQVcsRUFBRSxxQkFBUyxHQUFHLEVBQUU7QUFDekIsV0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztHQUNuQjs7Q0FFRixDQUFDOztBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IHRvcyBvbiAwNi4xMS4yMDE1LlxyXG4gKi9cclxuXHJcbmxldCBjaGF0ID0gcmVxdWlyZSgnLi9jaGF0L2NoYXQnKTtcclxubGV0IHdzID0gcmVxdWlyZSgnLi9jaGF0L3dlYnNvY2tldCcpO1xyXG5cclxuY29uc29sZS5sb2coJ3N0YXJ0IGFwcCcpO1xyXG5cclxud3MuY29ubmVjdCgnd3M6Ly9sb2NhbGhvc3Q6ODA4MCcpO1xyXG5cclxud3Mub25Nc2coJ215TXNnJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICBjb25zb2xlLmxvZygnTmV3IG15TXNnIG1lc3NhZ2UnLCBkYXRhKTtcclxufSk7XHJcblxyXG5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgd3Muc2VuZFRlc3RNc2coJ3Rlc3QgbWVzc2FnZSBmcm9tIGFwcCcpO1xyXG59LDIwMDApOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IHRvcyBvbiAwNi4xMS4yMDE1LlxyXG4gKi9cclxuXHJcbmxldCB3cyA9IHJlcXVpcmUoJy4vd2Vic29ja2V0LmpzJyk7XHJcblxyXG5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgd3Muc2VuZFRlc3RNc2coJ3Rlc3QgbWVzc2FnZSBmcm9tIGNoYXQnKTtcclxufSwyMDAwKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6ICd0MHMnLFxyXG4gICAgbWVzc2FnZXM6IDEwXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiAndGVzdCcsXHJcbiAgICBtZXNzYWdlczogNVxyXG4gIH1cclxuXTsiLCIvKipcclxuICogQ3JlYXRlZCBieSB0b3Mgb24gMDcuMTEuMjAxNS5cclxuICovXHJcblxyXG5sZXQgX3NvY2tldCxcclxuICAgIF9ldmVudHMgPSB7fTtcclxuY29uc3QgV1NfVFlQRV9ORVcgPSAnbmV3JyxcclxuICAgICAgV1NfVFlQRV9NU0cgPSBcIm1lc3NhZ2VcIjtcclxuXHJcbmZ1bmN0aW9uIG1lc3NhZ2UodHlwZSxkYXRhKSB7XHJcbiAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICBjYXNlIHR5cGVzLk5FVzpcclxuICAgICAgcmV0dXJuIHt0eXBlOiB0eXBlcy5ORVcsIGxvZ2luOiBkYXRhLmxvZ2lufTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIHR5cGVzLk1FU1NBR0U6XHJcbiAgICAgIHJldHVybiB7dHlwZTogdHlwZXMuTUVTU0FHRSwgbG9naW46ZGF0YS5sb2dpbiwgbXNnOiBkYXRhLm1zZywgdGltZTogZGF0YS50aW1lfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBkZWZhdWx0IDpcclxuICAgICAgLy9ub3RoaW5nXHJcbiAgfVxyXG59XHJcblxyXG5sZXQgV1MgPSB7XHJcblxyXG4gIGNvbm5lY3Q6IGZ1bmN0aW9uKHVybCkge1xyXG4gICAgY29uc29sZS5sb2coJ3N0YXJ0aW5nIHdzJyk7XHJcbiAgICBpZiAoX3NvY2tldCkgcmV0dXJuIEVycm9yKCfQo9C20LUg0LXRgdGC0Ywg0YHQvtC10LTQuNC90LXQvdC40LUnKTtcclxuXHJcbiAgICBfc29ja2V0ID0gbmV3IFdlYlNvY2tldCh1cmwpO1xyXG5cclxuICAgIF9zb2NrZXQub25vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIF9zb2NrZXQuc2VuZCgnSGVsbG8gd29ybGQyJyk7XHJcbiAgICB9O1xyXG4gICAgX3NvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24oZXZlbnQpIHsgY29uc29sZS5sb2coJ9Ca0L7QtDogJyArIGV2ZW50LmNvZGUgKyAnINC/0YDQuNGH0LjQvdCwOiAnICsgZXZlbnQucmVhc29uKTsgfTtcclxuICAgIF9zb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgV1MuZW1pdE1zZygnbXlNc2cnLCBldmVudC5kYXRhKTtcclxuICAgICAgY29uc29sZS5sb2coXCLQn9C+0LvRg9GH0LXQvdGLINC00LDQvdC90YvQtVwiICsgZXZlbnQuZGF0YSk7XHJcbiAgICB9O1xyXG4gICAgX3NvY2tldC5vbmVycm9yID0gZnVuY3Rpb24oZXJyb3IpIHsgY29uc29sZS5sb2coXCLQntGI0LjQsdC60LAgXCIgKyBlcnJvci5tZXNzYWdlKTsgfTtcclxuXHJcbiAgICByZXR1cm4gX3NvY2tldDtcclxuICB9LFxyXG5cclxuICBnZXRTb2NrZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIF9zb2NrZXQ7XHJcbiAgfSxcclxuXHJcbiAgb25Nc2c6IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykge1xyXG4gICAgX2V2ZW50c1tldmVudF0gPSBfZXZlbnRzW2V2ZW50XSA/IF9ldmVudHNbZXZlbnRdLnB1c2goY2FsbGJhY2spIDogW107XHJcbiAgfSxcclxuXHJcbiAgZW1pdE1zZzogZnVuY3Rpb24oZXZlbnQsIGFyZykge1xyXG4gICAgaWYgKF9ldmVudHMuaGFzT3duUHJvcGVydHkoZXZlbnQpKSB7XHJcbiAgICAgIF9ldmVudHNbZXZlbnRdLm1hcChmdW5jdGlvbih2KXtcclxuICAgICAgICB2KGFyZyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIHNlbmRUZXN0TXNnOiBmdW5jdGlvbih0eHQpIHtcclxuICAgIF9zb2NrZXQuc2VuZCh0eHQpO1xyXG4gIH1cclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFdTOyJdfQ==
